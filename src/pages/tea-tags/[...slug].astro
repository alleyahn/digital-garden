---
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';

export async function getStaticPaths() {
  const teaCollection = await getCollection('tea');
  return teaCollection.map(entry => ({
    params: { slug: entry.slug },
    props: { entry }
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

// Get all tea for navigation
const allTea = await getCollection('tea');
const currentIndex = allTea.findIndex(tea => tea.slug === entry.slug);
const previousTea = currentIndex > 0 ? allTea[currentIndex - 1] : null;
const nextTea = currentIndex < allTea.length - 1 ? allTea[currentIndex + 1] : null;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={`${entry.data.brand} ${entry.data.variant} - Tea tag from ${entry.data.country}`} />
    <title>{entry.data.brand} {entry.data.variant} - Tea Collection</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Geist+Mono:wght@400;500;600;700&family=Instrument+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  </head>
  
  <body>
    <div class="container">
      <div class="tea-detail-header">
        <a href="/tea-tags" class="back-link">← Back to collection</a>
      </div>

      <div class="tea-detail-container">
        <div class="tea-detail-image">
          <Image 
            src={entry.data.image} 
            alt={entry.data.alt || `${entry.data.brand} ${entry.data.variant}`}
            class="detail-image"
          />
        </div>

        <div class="tea-detail-content">
          <div class="tea-detail-header-info">
            <h1>{entry.data.brand}</h1>
            <h2>{entry.data.variant}</h2>
          </div>

          <div class="tea-detail-meta">
            <div class="meta-item">
              <span class="meta-label">Type:</span>
              <span class="meta-value">{entry.data.teaType}</span>
            </div>
            <div class="meta-item">
              <span class="meta-label">Country:</span>
              <span class="meta-value">{entry.data.country}</span>
            </div>
          </div>

          {entry.body && (
            <div class="tea-detail-text">
              <Content />
            </div>
          )}

          <!-- Navigation -->
          <div class="tea-navigation">
            {previousTea && (
              <a href={`/tea-tags/${previousTea.slug}`} class="nav-link prev-link">
                ← {previousTea.data.brand} {previousTea.data.variant}
              </a>
            )}
            {nextTea && (
              <a href={`/tea-tags/${nextTea.slug}`} class="nav-link next-link">
                {nextTea.data.brand} {nextTea.data.variant} →
              </a>
            )}
          </div>
        </div>
      </div>
    </div>

    <style>
      :root {
        --color-cream: #F7E2D2;
        --color-salmon: #FB8484;
        --color-text: #1a1a1a;
        --color-text-secondary: #666666;
        --color-link: #215DB1;
        --color-light-gray: #F0F0F0;
        
        --font-mono: 'Geist Mono', 'Courier New', monospace;
        --font-sans: 'Instrument Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        scroll-behavior: smooth;
      }

      body {
        font-family: var(--font-sans);
        background: var(--color-cream);
        color: var(--color-text);
        line-height: 1.6;
        padding: 60px 80px;
        font-size: 14px;
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
      }

      .tea-detail-header {
        margin-bottom: 40px;
      }

      .back-link {
        color: var(--color-link);
        text-decoration: none;
        font-size: 14px;
        display: inline-block;
        position: relative;
      }

      .back-link::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 0;
        height: 2px;
        background: currentColor;
        transition: width 0.3s ease;
      }

      .back-link:hover::after {
        width: 100%;
      }

      .tea-detail-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 60px;
        align-items: start;
      }

      .tea-detail-image {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        aspect-ratio: 1;
      }

      .detail-image {
        width: 100%;
        height: 100%;
        object-fit: contain;
      }

      .tea-detail-header-info h1 {
        font-family: var(--font-mono);
        font-size: 36px;
        font-weight: 600;
        margin-bottom: 8px;
      }

      .tea-detail-header-info h2 {
        font-size: 20px;
        font-weight: 400;
        color: var(--color-text-secondary);
        margin-bottom: 24px;
      }

      .tea-detail-meta {
        display: flex;
        gap: 24px;
        margin-bottom: 32px;
        padding-bottom: 24px;
        border-bottom: 2px solid var(--color-light-gray);
      }

      .meta-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .meta-label {
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: var(--color-text-secondary);
      }

      .meta-value {
        font-size: 16px;
        color: var(--color-text);
      }

      .tea-detail-text {
        margin-bottom: 32px;
        font-size: 15px;
        line-height: 1.8;
        color: var(--color-text);
      }

      .tea-detail-text :global(p) {
        margin-bottom: 12px;
      }

      .tea-detail-text :global(ul),
      .tea-detail-text :global(ol) {
        margin-left: 20px;
        margin-bottom: 12px;
      }

      .tea-detail-text :global(li) {
        margin-bottom: 6px;
      }

      .tea-navigation {
        display: flex;
        gap: 24px;
        justify-content: space-between;
        margin-top: 48px;
        padding-top: 24px;
        border-top: 2px solid var(--color-light-gray);
      }

      .nav-link {
        flex: 1;
        padding: 16px;
        background: white;
        border-radius: 8px;
        text-decoration: none;
        color: var(--color-link);
        font-size: 13px;
        transition: all 0.2s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
      }

      .nav-link:hover {
        background: var(--color-salmon);
        color: white;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.12);
      }

      .prev-link {
        text-align: left;
      }

      .next-link {
        text-align: right;
      }

      .nav-link:only-child {
        flex: none;
        max-width: 300px;
      }

      /* Responsive */
      @media (max-width: 1024px) {
        body {
          padding: 40px 20px;
        }

        .tea-detail-container {
          grid-template-columns: 1fr;
          gap: 40px;
        }

        .tea-detail-image {
          max-width: 400px;
          margin: 0 auto;
        }

        .tea-detail-header-info h1 {
          font-size: 28px;
        }
      }

      @media (max-width: 640px) {
        body {
          padding: 20px;
        }

        .container {
          margin: 0;
        }

        .tea-detail-header {
          margin-bottom: 24px;
        }

        .tea-detail-image {
          max-width: 100%;
          aspect-ratio: auto;
          min-height: 300px;
        }

        .tea-detail-header-info h1 {
          font-size: 20px;
        }

        .tea-detail-header-info h2 {
          font-size: 16px;
        }

        .tea-detail-meta {
          flex-direction: column;
          gap: 16px;
        }

        .tea-navigation {
          flex-direction: column;
          gap: 12px;
        }

        .nav-link {
          text-align: center !important;
        }
      }
    </style>
  </body>
</html>
